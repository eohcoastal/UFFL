CREATE FUNCTION [uffl].[tvf_DelimStrToColumn]
/*****************************************************************************************************************************************************************************************
	Synopsis:	Translate delimited strings to columns
				
				Current limitations
				-	64 column limit. To add more columns find of CEILING(SQRT(n)) where n are the number of columns sought and modify the CTEs on this basis
				-	Delimiter limited to single character


	======================================================================================================================================================================================
	Change Log
	======================================================================================================================================================================================
	ID		WHEN		WHO					TICKET						WHAT
	======================================================================================================================================================================================
	1		2018-08-31	MDiamond										Created
	======================================================================================================================================================================================

	======================================================================================================================================================================================
	Review Log
	======================================================================================================================================================================================
	ID		WHEN		WHO					WHAT
	======================================================================================================================================================================================

	======================================================================================================================================================================================

*****************************************************************************************************************************************************************************************/
(
	 @InputString		VARCHAR(1500)
	,@Delimiter			CHAR(1)
)
RETURNS TABLE AS RETURN
(
	WITH Base8(n) AS
	(
			SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
			SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
			SELECT 1 UNION ALL SELECT 1 
	)
	,Numbers64(n) AS
	(
		SELECT CAST(ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS INT)
		FROM Base8 a, Base8 b
	)
	,Tokens AS
	(
		SELECT	 Item
				,ItemNumber
		FROM uffl.tvf_DelimitedSplit8K(@InputString, @Delimiter)
	)
	,PrePivot AS
	(
		SELECT	 BS.N
				,TK.Item
		FROM Numbers64	BS
		LEFT
		JOIN Tokens		TK	ON BS.N = TK.ItemNumber
	)
	SELECT [1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [13], [14], [15], [16], [17], [18], [19], [20], [21], [22], [23], [24], [25], [26], [27], [28], [29], [30], [31], [32], [33], [34], [35], [36], [37], [38], [39], [40], [41], [42], [43], [44], [45], [46], [47], [48], [49], [50], [51], [52], [53], [54], [55], [56], [57], [58], [59], [60], [61], [62], [63], [64]
	FROM
	(
		SELECT	 N
				,Item 
		FROM PrePivot
	) AS SourceTable
	PIVOT
	(
		MAX(Item)
		FOR N IN ([1], [2], [3], [4], [5], [6], [7], [8], [9], [10], [11], [12], [13], [14], [15], [16], [17], [18], [19], [20], [21], [22], [23], [24], [25], [26], [27], [28], [29], [30], [31], [32], [33], [34], [35], [36], [37], [38], [39], [40], [41], [42], [43], [44], [45], [46], [47], [48], [49], [50], [51], [52], [53], [54], [55], [56], [57], [58], [59], [60], [61], [62], [63], [64])
	) AS PivotTable
)
;
